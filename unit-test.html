<html>
	<head>
		<title>Unit Testing for Stateless</title>
		<Script src="stateless.js"></script>
        <style>
            div {
                padding: 5px;
            }
        </style>
	</head>
	<body>
		<div id="wrap"></div>
		<span id="wrap"></span>
		<div class="div"></div>

		<script>
			function verdict(verdict, input, output, test){
				this.verdict = verdict
				this.input = input
				this.output = output
				this.test = test
			}

			var results = {}
			function testRegister(input, expectedChecker){
				var selfResults = results.registerFn = results.registerFn || []
				var output
                try {
                    output = stateless.register(input)
                }
                catch(o3o){
                    output = o3o
                }
				if (expectedChecker(output, input)) {
					selfResults.push(new verdict("pass", input, output, testRegister))
				}
				else {
					selfResults.push(new verdict("failed", input, output, testRegister))
				}
			}

			testRegister(document.querySelector(".div"), function(output, input){
				try {
					if (
						output == stateless &&
						input.getAttribute("id") == null &&
						stateless[0] == input &&
                        document.querySelector(".div:not([id])") == null
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
			})

			testRegister(document.querySelector("div#wrap"), function(output, input){
				try {
					if (
						output == stateless &&
						input.getAttribute("id") == null &&
						stateless[1] == input &&
                        stateless.wrap == stateless[1] &&
                        document.querySelector("div#wrap") == null
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
			})

			testRegister(document.querySelector("span#wrap"), function(output, input){
				try {
					if (
						output instanceof Error &&
						input.getAttribute("id") != null &&
						stateless[1] != input &&
                        stateless.wrap == stateless[1] &&
                        typeof stateless[2] == "undefined" &&
                        document.querySelector("span#wrap") != null
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
			})

            testRegister(`<div id="was-string"></div>`, function(output, input){
                try {
                    input = input.replace("id", "class")
					if (
                        output == stateless &&
						stateless[2].outerHTML == input &&
                        stateless["was-string"] == stateless[2]
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
            })

            testRegister(`<div id="was-string-2" class="some-other-class"></div>`, function(output, input){
                try {
                    input = input.replace("id", "class")
					if (
                        output == stateless &&
						stateless[3].outerHTML == `<div class="was-string-2 some-other-class"></div>` &&
                        stateless["was-string-2"] == stateless[3]
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
            })

            testRegister(`
                <div id="was-string-4"></div>
                <div id="was-string-5" class="some-other-class"></div>
            `, function(output, input){
                try {
                    input = input.replace("id", "class")
					if (
                        output == stateless &&
						stateless[4].outerHTML == `<div class="was-string-4"></div>` &&
                        stateless["was-string-4"] == stateless[4] &&
						stateless[5].outerHTML == `<div class="was-string-5 some-other-class"></div>` &&
                        stateless["was-string-5"] == stateless[5]
					){
						return true
					}
					return false
				} catch(o3o){
					return false
				}
            })
		</script>

        <script>
            function displayResultRow(test, index, results) {
                var div, title, message
                div = document.createElement("div")
                div.appendChild(title = document.createElement("strong"))
                title.appendChild(document.createTextNode(test + " " + index + ": "))
                div.appendChild(document.createTextNode(results.verdict))

                if (results.verdict == "failed"){
                    div.style.backgroundColor = "red"

                    div.appendChild(message = document.createElement("div"))
                    message.appendChild(document.createTextNode("Please see console for further details"))
                    console.warn(test, index , results)
                } else {
                    console.log(test, index , results)
                }
                document.body.appendChild(div)
            }

            for (var test in results) {
                results[test].forEach(function(item, index){
                    displayResultRow(test, index, item);
                })
            }
        </script>
	</body>
</html>
